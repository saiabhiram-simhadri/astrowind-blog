---
import type { ImageMetadata } from 'astro';
import { Icon } from 'astro-icon/components';
import Image from '~/components/common/Image.astro';
import PostTags from '~/components/blog/Tags.astro';

import { APP_BLOG } from '~/utils/config';
import type { Post } from '~/types';

import { getPermalink } from '~/utils/permalinks';
import { findImage } from '~/utils/images';
import { getFormattedDate } from '~/utils/utils';

export interface Props {
  post: Post;
}

const { post } = Astro.props;
const image = (await findImage(post.image)) as ImageMetadata | undefined;

const link = APP_BLOG?.post?.isEnabled ? getPermalink(post.permalink, 'post') : '';
---

<article class="bg-white dark:bg-gray-800 shadow-lg rounded-md overflow-hidden transition duration-300 transform hover:bg-gray-100 dark:hover:bg-gray-700">
  <div class="grid grid-cols-1 md:grid-cols-2">
    {image && (
      <div class="relative overflow-hidden w-full h-48 md:h-auto md:w-30">
        <Image
          src={image}
          class="object-cover w-full h-full rounded-md md:rounded-r-none"
          alt={post.title}
          aspectRatio="16:9"
          loading="lazy"
          decoding="async"
        />
      </div>
    )}

    <div class="p-4 md:p-6 md:w-70 flex flex-col justify-between">
      <div>
        <div class="mb-2 text-sm text-gray-600 dark:text-gray-400 flex items-center">
          <Icon name="tabler:clock" class="w-4 h-4 inline-block -mt-0.5 mr-1.5 dark:text-gray-400" />
          <time datetime={String(post.publishDate)}>{getFormattedDate(post.publishDate)}</time>

          {post.author && (
            <>
              <span class="mx-2">·</span>
              <Icon name="tabler:user" class="w-4 h-4 inline-block -mt-0.5 mr-1.5 dark:text-gray-400" />
              <span>{post.author.replaceAll('-', ' ')}</span>
            </>
          )}

          {post.category && (
            <>
              <span class="mx-2">·</span>
              <a class="hover:underline" href={getPermalink(post.category, 'category')}>
                {post.category.replaceAll('-', ' ')}
              </a>
            </>
          )}
        </div>

        <h2 class="text-xl font-bold leading-tight mb-2 text-gray-800 dark:text-white hover:underline md:mt-2">
          {link ? (
            <a href={link}>
              {post.title}
            </a>
          ) : (
            post.title
          )}
        </h2>

        {post.excerpt && <p class="text-gray-700 dark:text-gray-400 text-sm mb-4">{post.excerpt}</p>}
      </div>

      <footer>
        <PostTags tags={post.tags} class="flex flex-wrap gap-2 mt-2"></PostTags>
      </footer>
    </div>
  </div>
</article>

